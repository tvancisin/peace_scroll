<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basic Donut Chart with Transitions</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <style>
        body {
            background-color: black;
        }

        .slice {
            cursor: pointer;
        }

        .slice:hover {
            fill-opacity: 0.8;
        }
    </style>
</head>

<body>
    <svg width="300" height="300"></svg>
    <button id="hovno">Transition full</button>
    <button id="dvahovno">Transition zero</button>

    <script>
        let data = [
            { label: 'A', value: 30, color: 'red' },
            { label: 'B', value: 20, color: 'blue' },
            { label: 'C', value: 50, color: 'green' }
        ];

        const width = 300;
        const height = 300;
        const radius = Math.min(width, height) / 2;

        const svg = d3.select('svg')
            .append('g')
            .attr('transform', `translate(${width / 2},${height / 2})`);

        const arc = d3.arc()
            .innerRadius(radius * 0.6)
            .outerRadius(radius);

        const pie = d3.pie()
            .value(d => d.value)
            .sort(null);

        const path = svg.selectAll('path')
            .data(pie(data))
            .enter()
            .append('path')
            // .attr('d', arc)
            .attr('fill', d => d.data.color)
            .attr('class', 'slice');

        // Transition to zero
        d3.select('#hovno').on('click', function () {
            // console.log("here");
            // data = data.map(d => ({ ...d, value: 0 }));
            // console.log(data);
            // path.data(pie(data))
            //     .transition()
            //     .duration(1000)
            //     .attrTween('d', function (d) {
            //         const interpolate = d3.interpolate(this._current, d);
            //         this._current = d;
            //         return function (t) {
            //             return arc(interpolate(t));
            //         };
            //     });
            // Initial transition
            let data = [
                { label: 'A', value: 30, color: 'red' },
                { label: 'B', value: 20, color: 'blue' },
                { label: 'C', value: 50, color: 'green' }
            ];
            path
                .data(pie(data))
                .transition()
                .duration(1000)
                .attrTween('d', function (d) {
                    const interpolate = d3.interpolate({ startAngle: 0, endAngle: 0 }, d);
                    this._current = interpolate(0);
                    return function (t) {
                        return arc(interpolate(t));
                    };
                });
        });
        d3.select('#dvahovno').on('click', function () {
            // console.log("here");
            data = data.map(d => ({ ...d, value: 0 }));
            console.log(data);
            path.data(pie(data))
                .transition()
                .duration(1000)
                .attrTween('d', function (d) {
                    console.log(this._current);
                    const interpolate = d3.interpolate(this._current, d);
                    this._current = d;
                    return function (t) {
                        return arc(interpolate(t));
                    };
                });

        })
    </script>
</body>

</html>